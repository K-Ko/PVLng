var qs,dFrom,dTo,pvlng=new function(){this.maxFutureDays=2,this.verbose=!1,this.dp,this.dpFrom,this.dpTo,this.cookie=new function(){this.set=function(e,t,a){var n="";if(a){var i=new Date;i.setTime(i.getTime()+864e5*a),n="; expires="+i.toGMTString()}document.cookie=escape(e)+"="+escape(t)+n+"; path=/"},this.get=function(e){for(var t,a=escape(e)+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(t=n[i];" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf(a))return unescape(t.substring(a.length,t.length))}return null},this.remove=function(e){this.set(e,"",-1)}},this.onFinished=new function(){var e=[];this.add=function(){$.each(arguments,function(t,a){e.push(a)})},this.run=function(t){$.each(e,function(e,t){t()})}},this.scroll=function(e){$("html, body").stop().animate({scrollTop:$(e).offset().top-3},"fast")},this.alert=function(e,t){1==arguments.length&&(t=""),$("<div/>").dialog({title:t,resizable:!1,modal:!0,width:480,buttons:{Ok:function(){$(this).dialog("close")}},close:function(){$(this).remove()}}).html(e).find(".ui-dialog-titlebar-close").remove()},this.addClearSearchButton=function(e,t){$("<img />").prop("src","/images/ico/cross-script.png").appendTo($("#"+e+"_filter")).css({marginLeft:"4px",cursor:"pointer"}).prop("title",t).tipTip().click(function(){$(this).parent().find("input").val("").trigger("keyup").focus()})},this.log=function(){this.verbose&&(1==arguments.length?console.log(arguments[0]):($(arguments).each(function(e,t){0==e?console.group(t):"[object Array]"===Object.prototype.toString.call(t)?console.table(t):console.log(t)}),console.groupEnd()))},this.calcDates=function(e){e=e||0;var t,a,n,i,o=$.datepicker.parseDate("mm/dd/yy",$("#timerangedate").val()),r=$('input[name="timerange"]:checked').val(),s=presetPeriods.split(";");switch(n=o.dst(),r){case"d":t=new Date(o.getTime()+864e5*e),a=new Date(t),i=this.dp.data("dateFormat"),s="undefined"!=typeof views&&views.preset?views.preset:s[0];break;case"w":var c=o.getDay()-1;0>c&&(c=7+c),t=new Date(o.getTime()+7*e*864e5-864e5*c),a=new Date(t.getTime()+5184e5),i=this.dp.datepicker("option","weekHeader")+" "+$.datepicker.iso8601Week(t)+".yy",s=s[1];break;case"m":var d=o.getFullYear(),p=o.getMonth()+e;0>p?(p=12+p,d-=1):p>11&&(p=12-p,d+=1),t=new Date(d,p,1),a=new Date(d,p+1,0),i="MM yy",s=s[2];break;case"y":var d=o.getFullYear()+e;t=new Date(d,0,1),a=new Date(d+1,0,0),i="yy",s=s[3]}a=new Date(Math.min(a,new Date((new Date).getTime()+864e5*this.maxFutureDays))),n!=t.dst()&&t.addTime(36e5*-e),n!=a.dst()&&a.addTime(36e5*-e),this.dp.setDate(t,i),this.dpFrom.datepicker("option","maxDate",a).datepicker("setDate",t),this.dpTo.datepicker("option","minDate",t).datepicker("setDate",a),$("#dp1").is(":visible")&&($("#preset").length?setTimeout(function(){$("#preset").val(s).trigger("change")},0):"function"==typeof afterDatesCalculated&&setTimeout(afterDatesCalculated,0))},this.changeDate=function(e){this.calcDates(e)},this.changeDates=function(e){var t=new Date(this.dpFrom.datepicker("getDate").getTime()+864e5*e),a=new Date(this.dpTo.datepicker("getDate").getTime()+864e5*e);return a>(new Date).getTime()+864e5?void $.pnotify({type:"info",text:"Can't go beyond tomorrow."}):(this.dpFrom.datepicker("option","maxDate",a).datepicker("setDate",t),this.dpTo.datepicker("option","minDate",t).datepicker("setDate",a),this.dp.setDate(t),void updateOutput())},this.changePreset=function(){var e=$("#preset").val().match(/(\d+)(\w+)/);if(e){if($("#dp2").is(":visible")){var t=new Date(pvlng.dpFrom.datepicker("getDate"));switch(e[2]){case"d":case"w":t.setDate(1);break;case"m":t.setDate(1),t.setMonth(0)}pvlng.dpFrom.datepicker("setDate",t)}$("#periodcnt").val(e[1]),$("#period").val(e[2])}else $("#periodcnt").val(1),$("#period").val("");$("#period").trigger("change")},this.profile=function(e){var t=new Date;return e(),new Date-t};var e=[];this.time=function(t){e.push({start:performance.now(),label:t})},this.timeEnd=function(){var t=e.pop();if(t){var a=performance.now()-t.start;return this.verbose&&console.log(t.label+": "+(a/1e3).toFixed(3)+"s"),a}},this.guid=function(e){return e=e?e+"-":"",e+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,a="x"==e?t:3&t|8;return a.toString(16)})}};$(function(){$.extend({alert:function(e,t){1==arguments.length&&(t=""),$("<div/>").dialog({modal:!0,resizable:!1,title:t,width:480,open:function(){$(".ui-dialog-titlebar-close").hide()},buttons:{Ok:function(){$(this).dialog("close")}},close:function(){$(this).remove()}}).html(e)},confirm:function(e,t,a,n){t||(t="Confirm"),a||(a="Ok"),n||(n="Cancel");var i=$.Deferred(),o={modal:!0,resizable:!1,title:t,width:480,open:function(){$(".ui-dialog-titlebar-close").hide()},buttons:{},close:function(){$(this).remove()}};return o.buttons[a]=function(){return $(this).dialog("close"),i.resolve(!0),!0},o.buttons[n]=function(){return $(this).dialog("close"),i.resolve(!1),!1},$("<div/>").html(e).dialog(o),i.promise()}}),qs=$.parseQueryString(),qs.refresh&&(RefreshTimeout=qs.refresh),qs.from&&qs.to?(dFrom=new Date("-"!=qs.from.substr(0,1)?qs.from:(new Date).getTime()+864e5*qs.from),dTo=new Date("+"!=qs.to.substr(0,1)?qs.to:(new Date).getTime()+864e5*qs.to)):dFrom=dTo=qs.date?new Date(qs.date):new Date,pvlng.dp=$("#timerange").datepicker({altField:"#timerangedate",altFormat:"mm/dd/yy",maxDate:pvlng.maxFutureDays,showButtonPanel:!0,showWeek:!0,changeMonth:!0,changeYear:!0,showOn:null,onClose:function(e,t){e!=t.lastVal&&($(this).datepicker("setDate",new Date(t.selectedYear,t.selectedMonth,t.selectedDay)),pvlng.calcDates())}}).datepicker("setDate",dTo),pvlng.dp.setDate=function(e,t){t&&this.datepicker("option","dateFormat",t),this.datepicker("setDate",e).datepicker("option","maxDate",pvlng.maxFutureDays)},pvlng.dp.data("dateFormat",pvlng.dp.datepicker("option","dateFormat")),$("#dpCalendar").on("click",function(){$($(this).data("input")).datepicker("show")}),$('input[name="timerange"]').on("change",function(){"d"==$(this).val()?$("#dpCalendar").show():$("#dpCalendar").hide(),pvlng.calcDates()}),pvlng.dpFrom=$("#from").datepicker({altField:"#fromdate",altFormat:"mm/dd/yy",autoSize:!0,maxDate:0,showButtonPanel:!0,showWeek:!0,changeMonth:!0,changeYear:!0,onClose:function(e){pvlng.dpTo.datepicker("option","minDate",e)}}).datepicker("setDate",dFrom),pvlng.dpTo=$("#to").datepicker({altField:"#todate",altFormat:"mm/dd/yy",autoSize:!0,maxDate:pvlng.maxFutureDays,showButtonPanel:!0,showWeek:!0,changeMonth:!0,changeYear:!0,onClose:function(e){pvlng.dpFrom.datepicker("option","maxDate",e)}}).datepicker("setDate",dTo),$("#btn-reset").on("click",function(e){var t=new Date;pvlng.dpFrom.datepicker("option","maxDate",t),pvlng.dpTo.datepicker("option","minDate",t),chart&&chart.zoomOut(),pvlng.dp.setDate(t),$("#timerange-day").prop("checked",!0).trigger("change"),$("#dp2").is(":visible")&&setTimeout(function(){$("#preset").trigger("change")},0)}),$("#preset").on("change",function(){pvlng.changePreset(),updateOutput()})});