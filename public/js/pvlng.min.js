var qs,dFrom,dTo,pvlng=new function(){this.verbose=!1,this.dp,this.dpFrom,this.dpTo,this.cookie=new function(){this.set=function(e,t,a){var n="";if(a){var i=new Date;i.setTime(i.getTime()+864e5*a),n="; expires="+i.toGMTString()}document.cookie=escape(e)+"="+escape(t)+n+"; path=/"},this.get=function(e){for(var t=escape(e)+"=",a=document.cookie.split(";"),n=0;n<a.length;n++){for(var i=a[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return unescape(i.substring(t.length,i.length))}return null},this.remove=function(e){this.set(e,"",-1)}},this.onFinished=new function(){var e=[];this.add=function(){$.each(arguments,function(t,a){e.push(a)})},this.run=function(t){$.each(e,function(e,t){t()})}},this.scroll=function(e){$("html, body").stop().animate({scrollTop:$(e).offset().top-3},"fast")},this.alert=function(e,t){1==arguments.length&&(t=""),$("<div/>").dialog({title:t,resizable:!1,modal:!0,width:480,buttons:{Ok:function(){$(this).dialog("close")}},close:function(){$(this).remove()}}).html(e).find(".ui-dialog-titlebar-close").remove()},this.addClearSearchButton=function(e,t){$("<img />").prop("src","/images/ico/cross-script.png").appendTo($("#"+e+"_filter")).css({marginLeft:"4px",cursor:"pointer"}).prop("title",t).tipTip().click(function(){$(this).parent().find("input").val("").trigger("keyup").focus()})},this.log=function(){this.verbose&&(1==arguments.length?console.log(arguments[0]):($(arguments).each(function(e,t){0==e?console.group(t):"[object Array]"===Object.prototype.toString.call(t)?console.table(t):console.log(t)}),console.groupEnd()))},this.calcDates=function(e){e=e||0;var t,a,n,i=$.datepicker.parseDate("mm/dd/yy",$("#timerangedate").val()),o=$('input[name="timerange"]:checked').val(),r=presetPeriods.split(";");switch(o){case"d":t=new Date(i.getTime()+864e5*e),a=new Date(t),n=this.dp.data("dateFormat"),r="undefined"!=typeof views&&views.preset?views.preset:r[0];break;case"w":var s=i.getDay()-1;0>s&&(s=7+s),t=new Date(i.getTime()+7*e*864e5-864e5*s),a=new Date(t.getTime()+5184e5),n=this.dp.datepicker("option","weekHeader")+" "+$.datepicker.iso8601Week(t)+".yy",r=r[1];break;case"m":var c=i.getFullYear(),d=i.getMonth()+e;0>d?(d=12+d,c-=1):d>11&&(d=12-d,c+=1),t=new Date(c,d,1),a=new Date(c,d+1,0),n="MM yy",r=r[2];break;case"y":var c=i.getFullYear()+e;t=new Date(c,0,1),a=new Date(c+1,0,0),n="yy",r=r[3]}this.dp.setDate(t,n),a=new Date(Math.min(a,new Date((new Date).getTime()+2592e5))),this.dpFrom.datepicker("option","maxDate",a).datepicker("setDate",t),this.dpTo.datepicker("option","minDate",t).datepicker("setDate",a),$("#dp1").is(":visible")&&($("#preset").length?setTimeout(function(){$("#preset").val(r).trigger("change")},0):"function"==typeof afterDatesCalculated&&setTimeout(afterDatesCalculated,0))},this.changeDate=function(e){this.calcDates(e)},this.changeDates=function(e){var t=new Date(this.dpFrom.datepicker("getDate").getTime()+864e5*e),a=new Date(this.dpTo.datepicker("getDate").getTime()+864e5*e);return a>(new Date).getTime()+864e5?void $.pnotify({type:"info",text:"Can't go beyond tomorrow."}):(this.dpFrom.datepicker("option","maxDate",a).datepicker("setDate",t),this.dpTo.datepicker("option","minDate",t).datepicker("setDate",a),this.dp.setDate(t),void updateOutput())},this.changePreset=function(){var e=$("#preset").val().match(/(\d+)(\w+)/);if(e){if($("#dp2").is(":visible")){var t=new Date(pvlng.dpFrom.datepicker("getDate"));switch(e[2]){case"d":case"w":t.setDate(1);break;case"m":t.setDate(1),t.setMonth(0)}pvlng.dpFrom.datepicker("setDate",t)}$("#periodcnt").val(e[1]),$("#period").val(e[2])}else $("#periodcnt").val(1),$("#period").val("");$("#period").trigger("change")},this.profile=function(e){var t=new Date;return e(),new Date-t};var e=[];this.time=function(t){e.push({start:performance.now(),label:t})},this.timeEnd=function(){var t=e.pop();if(t){var a=performance.now()-t.start;return this.verbose&&console.log(t.label+": "+(a/1e3).toFixed(3)+"s"),a}},this.guid=function(e){return e=e?e+"-":"",e+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,a="x"==e?t:3&t|8;return a.toString(16)})}};$(function(){$.extend({alert:function(e,t){1==arguments.length&&(t=""),$("<div/>").dialog({modal:!0,resizable:!1,title:t,width:480,open:function(){$(".ui-dialog-titlebar-close").hide()},buttons:{Ok:function(){$(this).dialog("close")}},close:function(){$(this).remove()}}).html(e)},confirm:function(e,t,a,n){t||(t="Confirm"),a||(a="Ok"),n||(n="Cancel");var i=$.Deferred(),o={modal:!0,resizable:!1,title:t,width:480,open:function(){$(".ui-dialog-titlebar-close").hide()},buttons:{},close:function(){$(this).remove()}};return o.buttons[a]=function(){return $(this).dialog("close"),i.resolve(!0),!0},o.buttons[n]=function(){return $(this).dialog("close"),i.resolve(!1),!1},$("<div/>").html(e).dialog(o),i.promise()}}),qs=$.parseQueryString(),qs.refresh&&(RefreshTimeout=qs.refresh),qs.from&&qs.to?(dFrom=new Date("-"!=qs.from.substr(0,1)?qs.from:(new Date).getTime()+864e5*qs.from),dTo=new Date("+"!=qs.to.substr(0,1)?qs.to:(new Date).getTime()+864e5*qs.to)):dFrom=dTo=qs.date?new Date(qs.date):new Date,pvlng.dp=$("#timerange").datepicker({altField:"#timerangedate",altFormat:"mm/dd/yy",maxDate:3,showButtonPanel:!0,showWeek:!0,changeMonth:!0,changeYear:!0,showOn:null,onClose:function(e,t){$(this).datepicker("setDate",new Date(t.selectedYear,t.selectedMonth,t.selectedDay)),pvlng.calcDates()}}).datepicker("setDate",dTo),pvlng.dp.setDate=function(e,t){t&&this.datepicker("option","dateFormat",t),this.datepicker("setDate",e)},pvlng.dp.data("dateFormat",pvlng.dp.datepicker("option","dateFormat")),$("#dpCalendar").on("click",function(){$($(this).data("input")).datepicker("show")}),$('input[name="timerange"]').on("change",function(){"d"==$(this).val()?$("#dpCalendar").show():$("#dpCalendar").hide(),pvlng.calcDates()}),pvlng.dpFrom=$("#from").datepicker({altField:"#fromdate",altFormat:"mm/dd/yy",autoSize:!0,maxDate:0,showButtonPanel:!0,showWeek:!0,changeMonth:!0,changeYear:!0,onClose:function(e){pvlng.dpTo.datepicker("option","minDate",e)}}).datepicker("setDate",dFrom),pvlng.dpTo=$("#to").datepicker({altField:"#todate",altFormat:"mm/dd/yy",autoSize:!0,maxDate:3,showButtonPanel:!0,showWeek:!0,changeMonth:!0,changeYear:!0,onClose:function(e){pvlng.dpFrom.datepicker("option","maxDate",e)}}).datepicker("setDate",dTo),$("#btn-reset").on("click",function(e){var t=new Date;pvlng.dpFrom.datepicker("option","maxDate",t),pvlng.dpTo.datepicker("option","minDate",t),chart&&chart.zoomOut(),pvlng.dp.setDate(t),$("#timerange-day").prop("checked",!0).trigger("change"),$("#dp2").is(":visible")&&setTimeout(function(){$("#preset").trigger("change")},0)}),$("#preset").on("change",function(){pvlng.changePreset(),updateOutput()})});