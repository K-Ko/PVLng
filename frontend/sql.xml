<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!--
/**
 *
 * @author      Knut Kohl <github@knutkohl.de>
 * @copyright   2012-2013 Knut Kohl
 * @license     GNU General Public License http://www.gnu.org/licenses/gpl.txt
 * @version     $Id$
 */
-->
<SQL>

	<APIkey>
		<![CDATA[
			SELECT `getAPIkey`()
		]]>
	</APIkey>

	<resetAPIkey>
		<![CDATA[
			DELETE FROM `pvlng_config` WHERE `key` = 'APIKey' LIMIT 1;
		]]>
	</resetAPIkey>

	<Tree>
		<![CDATA[
			SELECT `tree`.`id`
			      ,`tree`.`entity`
			      ,IF(`t`.`childs` <> 0, `tree`.`guid`, `c`.`guid`) AS `guid`
			      ,`c`.`name`
			      ,`c`.`serial`
			      ,`c`.`channel`
			      ,`c`.`description`
			      ,`c`.`resolution`
			      ,`c`.`cost`
			      ,`c`.`meter`
			      ,`c`.`numeric`
			      ,`c`.`unit`
			      ,`c`.`threshold`
			      ,`c`.`valid_from`
			      ,`c`.`valid_to`
			      ,`t`.`name` AS `type`
			      ,`t`.`model`
			      ,`t`.`childs`
			      ,`t`.`read`
			      ,`t`.`write`
			      ,`t`.`icon`
			  FROM `pvlng_tree` AS `tree`
			  JOIN `pvlng_channel` AS `c` ON `tree`.`entity` = `c`.`id`
			  JOIN `pvlng_type` AS `t` ON `c`.`type` = `t`.`id`
		]]>
	</Tree>

	<TreeById>
		<![CDATA[
			SELECT `tree`.`id`
			      ,`tree`.`entity`
			      ,IF(`t`.`childs` <> 0, `tree`.`guid`, `c`.`guid`) AS `guid`
			      ,`c`.`name`
			      ,`c`.`serial`
			      ,`c`.`channel`
			      ,`c`.`description`
			      ,`c`.`resolution`
			      ,`c`.`cost`
			      ,`c`.`meter`
			      ,`c`.`numeric`
			      ,`c`.`unit`
			      ,`c`.`threshold`
			      ,`c`.`valid_from`
			      ,`c`.`valid_to`
			      ,`t`.`name` AS `type`
			      ,`t`.`model`
			      ,`t`.`childs`
			      ,`t`.`read`
			      ,`t`.`write`
			      ,`t`.`icon`
			  FROM `pvlng_tree` AS `tree`
			  JOIN `pvlng_channel` AS `c` ON `tree`.`entity` = `c`.`id`
			  JOIN `pvlng_type` AS `t` ON `c`.`type` = `t`.`id`
			 WHERE `tree`.`id` = {1}
		]]>
	</TreeById>

	<TreeByGUID>
		<![CDATA[
			SELECT `tree`.`id`
			      ,`tree`.`entity`
			      ,IF(`t`.`childs` <> 0, `tree`.`guid`, `c`.`guid`) AS `guid`
			      ,`c`.`name`
			      ,`c`.`serial`
			      ,`c`.`channel`
			      ,`c`.`description`
			      ,`c`.`resolution`
			      ,`c`.`cost`
			      ,`c`.`meter`
			      ,`c`.`numeric`
			      ,`c`.`unit`
			      ,`c`.`threshold`
			      ,`c`.`valid_from`
			      ,`c`.`valid_to`
			      ,`t`.`name` AS `type`
			      ,`t`.`model`
			      ,`t`.`childs`
			      ,`t`.`read`
			      ,`t`.`write`
			      ,`t`.`icon`
			  FROM `pvlng_tree` AS `tree`
			  JOIN `pvlng_channel` AS `c` ON `tree`.`entity` = `c`.`id`
			  JOIN `pvlng_type` AS `t` ON `c`.`type` = `t`.`id`
			 WHERE IF(`t`.`childs` <> 0, `tree`.`guid`, `c`.`guid`) = "{1}"
		]]>
	</TreeByGUID>

	<Entity>
		<![CDATA[
			SELECT `c`.`id`
			      ,`c`.`guid`
			      ,`c`.`name`
			      ,`c`.`serial`
			      ,`c`.`channel`
			      ,`c`.`description`
			      ,`c`.`resolution`
			      ,`c`.`cost`
			      ,`c`.`numeric`
			      ,`c`.`unit`
			      ,`c`.`meter`
			      ,`c`.`threshold`
			      ,`c`.`valid_from`
			      ,`c`.`valid_to`
			      ,`t`.`name` AS `type`
			      ,`t`.`model`
			      ,`t`.`childs`
			      ,`t`.`read`
			      ,`t`.`write`
			      ,`t`.`graph`
			      ,`t`.`icon`
			  FROM `pvlng_channel` AS `c`
			  JOIN `pvlng_type` AS `t` ON `c`.`type` = `t`.`id`
			 WHERE `c`.`id` = {1}
		]]>
	</Entity>

	<Entities>
		<![CDATA[
			SELECT `c`.`id`
			      ,`c`.`guid`
			      ,`c`.`name`
			      ,`c`.`serial`
			      ,`c`.`channel`
			      ,`c`.`description`
			      ,`c`.`resolution`
			      ,`c`.`cost`
			      ,`c`.`numeric`
			      ,`c`.`unit`
			      ,`c`.`meter`
			      ,`c`.`threshold`
			      ,`c`.`valid_from`
			      ,`c`.`valid_to`
			      ,`t`.`name` AS `type`
			      ,`t`.`model`
			      ,`t`.`childs`
			      ,`t`.`read`
			      ,`t`.`write`
			      ,`t`.`graph`
			      ,`t`.`icon`
			  FROM `pvlng_channel` AS `c`
			  JOIN `pvlng_type` AS `t` ON `c`.`type` = `t`.`id`
			 WHERE `c`.`id` <> 1
			 ORDER BY `type`, `name`, `channel`, `description`
		]]>
	</Entities>

</SQL>